<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" href="Images/logo.png" type="image/png">
  <title>題矣</title>
</head>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<!-- Firebase v11.6.1 inline initialization -->
</head>

<body>
  <!-- 開始畫面 -->
  <div class="start-screen">
    <!-- Top Left Search -->
    <div class="search-container">
      <button id="searchIconBtn" class="search-icon-btn" aria-label="搜尋">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor">
          <path
            d="M784-120 532-372q-30 24-69 38t-83 14q-109 0-184.5-75.5T120-580q0-109 75.5-184.5T380-840q109 0 184.5 75.5T640-580q0 44-14 83t-38 69l252 252-56 56ZM380-400q75 0 127.5-52.5T560-580q0-75-52.5-127.5T380-760q-75 0-127.5 52.5T200-580q0 75 52.5 127.5T380-400Z" />
        </svg>
      </button>
      <input id="topicSearch" type="text" placeholder="搜尋題庫…" aria-label="搜尋題庫">
      <button id="searchCloseBtn" class="search-close-btn" aria-label="關閉搜尋">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor">
          <path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z" />
        </svg>
      </button>
    </div>

    <div class="top-right-controls">
      <button id="controlsMenuBtn" class="avatar-button" aria-haspopup="true" aria-expanded="false">
        <img id="controlsAvatar" src="Images/logo.png" alt="Profile" width="36" height="36">
      </button>
      <div id="controlsMenu" class="controls-menu" role="menu" aria-hidden="true">
        <div class="controls-menu-header">
          <img id="menuAvatar" class="menu-avatar" src="Images/logo.png" alt="Avatar" width="48" height="48">
          <div class="menu-user">
            <div id="menuDisplayName" class="menu-name">尚未登入</div>
            <div id="menuEmail" class="menu-email"></div>
          </div>
        </div>
        <div class="controls-separator"></div>
        <button class="controls-item" id="menuArchived" role="menuitem">典藏庫</button>
        <button class="controls-item" id="menuStarred" role="menuitem">已收藏</button>
        <button class="controls-item" id="menuShuffle" role="menuitem">隨機順序</button>
        <button class="controls-item" id="menuTheme" role="menuitem">深色模式</button>
        <button class="controls-item" id="menuAddQuiz" role="menuitem">新增題庫</button>
        <button class="controls-item" id="menuEditQuizName" role="menuitem">編輯題庫名稱</button>
        <div class="controls-separator"></div>
        <button class="controls-item" id="menuLogout" role="menuitem">登出</button>
      </div>
    </div>
    <!-- <input type="file" id="uploadJson" accept=".json" style="display:none;"> -->
    <button id="signInBtn" class="sign-in-button">
      <svg class="g-logo" width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z"
          fill="#4285F4"></path>
        <path
          d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.715H.957v2.332A8.997 8.997 0 0 0 9 18z"
          fill="#34A853"></path>
        <path
          d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957C.347 6.173 0 7.547 0 9c0 1.453.347 2.827.957 4.042l3.007-2.332z"
          fill="#FBBC05"></path>
        <path
          d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.159 6.656 3.58 9 3.58z"
          fill="#EA4335"></path>
      </svg>
      <span>使用 Google 帳戶登入</span>
    </button>
    <div class="start-title">題矣</div>
    <div class="header-right-homepage">
    </div>

    <!-- Main Content Area -->
    <div class="home-content">
      <div id="continue-section" style="display:none;">
        <div class="section-header">
          <h2 class="section-title">繼續</h2>
        </div>
        <div id="continue-card" class="continue-card">
          <div class="continue-details">
            <h3 id="continue-title-text" class="continue-title-text">Unit Name</h3>
            <div class="continue-progress-track">
              <div id="continue-progress-fill" class="continue-progress-fill"></div>
            </div>
            <p id="continue-stats-text" class="continue-stats-text">0/0 cards reviewed</p>
          </div>
          <button id="continue-btn-action" class="continue-btn-action">繼續</button>
        </div>
      </div>

      <div class="section-header">
        <h2 class="section-title">單元</h2>
      </div>

      <!-- Folder/Unit Navigation logic will render here -->
      <div id="folder-breadcrumb" class="folder-breadcrumb"></div> <!-- Replaces folder-toolbar -->
      <div id="units-grid" class="units-grid"></div> <!-- Replaces button-row -->
    </div>

    <!-- Hidden legacy elements if needed for script compatibility before full refactor -->
    <div id="folder-toolbar" style="display:none;"></div>
    <div id="button-row" style="display:none;"></div>
    <button id="startGame" style="display:none;">Start</button>
    <button id="restore" style="display:none;"></button>
  </div>

  <!-- 測驗內容 -->
  <div class="quiz-container">
    <div class="header">
      <div class="quiz-title">題矣</div>
      <div class="header-right">
        <button id="reverseButton" class="header-icon-btn" aria-label="上一題">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
            <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z" />
          </svg>
        </button>
        <button id="mistakeButton" class="header-icon-btn" aria-label="錯題列表">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
            <path
              d="M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.73 18c-.77 1.33.19 3 1.74 3zM12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z" />
          </svg>
        </button>
        <div id="quizTimer" class="timer-display" style="display:none;"></div>
      </div>
    </div>
    <!-- Progress Display -->
    <div class="progress-container">
      <div class="progress-counts">
        <div class="progress-count">
          <span class="count-text">答對</span>
          <span class="count-number" id="correct">0</span>
        </div>
        <div class="progress-count">
          <span class="count-number" id="wrong">0</span>
          <span class="count-text">答錯</span>
        </div>
      </div>
      <div class="progress-bars">
        <div id="correctBar" class="progress-bar correct-bar"></div>
        <div id="wrongBar" class="progress-bar wrong-bar"></div>
      </div>
    </div>
    <div class="question-content" id="question"></div>
    <div class="fillblank-container" style="display: none;">
      <input type="text" id="fillblank-input" class="fillblank-input" placeholder="請輸入完整句子，系統將自動驗證關鍵字">
    </div>
    <div class="options" id="options"></div>
    <button id="confirm-btn" class="confirm-button">確認</button>

    <div class="explanation" id="explanation">
      <div class="explanation-text" id="explanation-text"></div>
      <div id="origin-display" class="origin-display"></div>
      <div id="WeeGPTInputSection" style="display: none;">
        <div class="chat-input-wrapper">
          <input id="userQuestion" type="text" placeholder="詢問 Gemini..." autocomplete="off">
          <button id="sendQuestionBtn" class="chat-send-btn" aria-label="傳送">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
              <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" />
            </svg>
          </button>
        </div>
      </div>
      <div class="explanation-buttons">
        <div class="header-right">
          <button id="copy-btn" class="action-icon-btn" aria-label="複製題目">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 -960 960 960" width="24" fill="currentColor">
              <path
                d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0 33-23.5 56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z" />
            </svg>
          </button>
          <button id="WeeGPT" class="action-icon-btn gemini-btn" aria-label="詢問 Gemini">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 22C12 16.5 8 12 2 12C8 12 12 7.5 12 2C12 7.5 16 12 22 12C16 12 12 16.5 12 22Z" />
            </svg>
          </button>
          <button id="starQuestion" class="action-icon-btn star-btn" aria-label="收藏題目">
            <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
              <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z" />
            </svg>
          </button>
        </div>
        <button id="next-btn" class="next-button">下一題</button>
      </div>
    </div>
    <!-- <div class="copyright">
      © 2025 <a href="https://instagram.com/jedieason" target="_blank">Jedieason</a> 版權所有
    </div> -->
  </div>

  <!-- 自訂模態窗口 Notification Bar -->
  <div id="customAlert" class="notification-bar">
    <div class="notification-content">
      <span id="modal-message">選點啥吧</span>
    </div>
    <button id="modalConfirmBtn" class="notification-close" aria-label="Close">&times;</button>
  </div>

  <!-- Starred Questions Modal -->
  <div id="starredModal" class="modal">
    <div class="modal-content starred-modal-content">
      <span class="modal-close">&times;</span>
      <h3>已收藏的題目</h3>
      <div id="starredList"></div>
    </div>
  </div>

  <!-- Mistake Full Screen View -->
  <div id="mistakeView" class="full-screen-view">
    <div class="top-app-bar">
      <h2 class="view-title">錯題回顧</h2>
      <button id="closeMistakeViewBtn" class="action-icon-btn" aria-label="關閉">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
          <path
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </svg>
      </button>
    </div>
    <div id="mistakeScrollContainer" class="view-body">
      <div id="mistakeListContent"></div>
    </div>
  </div>
</body>
<!-- Upload Quiz Modal (Material 3) -->
<div id="uploadModal" class="md3-modal-overlay">
  <div class="md3-dialog">
    <div class="md3-dialog-header">
      <h3 class="md3-dialog-title">新增題庫</h3>
      <button class="md3-icon-btn modal-close" aria-label="Close">
        <svg xmlns="http://www.w3.org/2000/svg" height="24" viewBox="0 0 24 24" width="24" fill="currentColor">
          <path
            d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" />
        </svg>
      </button>
    </div>

    <div class="md3-dialog-body">
      <!-- Segmented Button for Mode Switch -->
      <div class="md3-segmented-btn-group">
        <label class="md3-segmented-btn">
          <input type="radio" name="upload-mode" value="paste" checked>
          <span>貼上 JSON</span>
        </label>
        <label class="md3-segmented-btn">
          <input type="radio" name="upload-mode" value="file">
          <span>上傳檔案</span>
        </label>
      </div>

      <!-- Helper Text or Instructions can go here -->

      <!-- Name Input -->
      <div class="md3-input-wrapper">
        <input type="text" id="uploadNameInput" class="md3-input" placeholder=" " required>
        <label for="uploadNameInput" class="md3-floating-label">題庫名稱</label>
      </div>

      <!-- Paste Area -->
      <div id="pasteSection" class="input-section">
        <div class="md3-input-wrapper textarea-wrapper">
          <textarea id="pasteJson" class="md3-textarea" placeholder=" "></textarea>
          <label for="pasteJson" class="md3-floating-label">JSON 內容</label>
        </div>
      </div>

      <!-- Drop Zone -->
      <div id="fileDropZone" class="file-drop-zone" style="display:none;">
        <input type="file" id="uploadJson" accept=".json" hidden>
        <div class="drop-zone-content">
          <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 0 24 24" width="48"
            fill="currentColor">
            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
          </svg>
          <p id="dropZoneLabel">點擊或拖曳 JSON 檔案至此</p>
        </div>
      </div>
    </div>

    <div class="md3-dialog-actions">
      <button class="md3-text-btn modal-close">取消</button>
      <button id="uploadConfirmBtn" class="md3-filled-btn">建立</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script type="module" src="script.js"></script>
</body>

</html>